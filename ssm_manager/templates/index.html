<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>SSM Manager</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="css/app.css">
    <script src="js/bootstrap.bundle.min.js" defer></script>
    <script src="js/vue.global.prod.js" defer></script>
    <script src="js/app.js" defer></script>
</head>
<body>
  <main id="app" class="d-flex flex-nowrap">

<!-- navbar -->

    <div class="d-flex flex-column flex-shrink-0 bg-body-tertiary" style="width: 4.5rem;">
      <a href="#/start" class="d-block p-3 link-body-emphasis text-decoration-none">
        <img width="40" src="/favicon.ico" alt="SSM Manager" class="d-block mx-auto mb-2">
      </a>
      <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
        <li class="nav-item" v-for="navItem in navBar">
          <a :href="navItem.hash" class="nav-link py-3 border-bottom rounded-0" :class="{ active: currentPage === navItem.name }" aria-current="page" data-bs-toggle="tooltip" data-bs-placement="right" :aria-label="navItem.name" :data-bs-original-title="navItem.name" @click="hideTooltip($event)">
            <i :class="navItem.icon"></i>
          </a>
        </li>
      </ul>
      <div class="border-top">
        <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
          <li class="nav-item">
            <a class="nav-link py-3 border-bottom rounded-0 text-secondary" aria-current="page" data-bs-toggle="tooltip" data-bs-placement="right" aria-label="Theme" data-bs-original-title="Theme" @click="themeToggle()">
              <i class="bi bi-circle-half"></i>
            </a>
          </li>
          <li class="nav-item">
            <a :href="githubUrl" class="nav-link py-3 border-bottom rounded-0 text-secondary" target="_blank" aria-current="page" data-bs-toggle="tooltip" data-bs-placement="right" aria-label="GitHub" data-bs-original-title="GitHub" @mouseup="hideTooltip($event)">
              <i class="bi bi-github"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>

<!-- page: home -->

    <div id="home" class="container-fluid page">
      <div class="px-4 py-5 my-5 text-center">
        <h1 class="display-5 fw-bold" v-html="title + ' v' + version"></h1>
        <div class="col-lg-6 mx-auto">
          <p class="lead mb-4">
            SSM Manager is a cross-platform desktop application that provides a web interface for managing AWS Systems Manager sessions.
            It simplifies the process of connecting to EC2 instances through AWS Systems Manager by providing an intuitive interface for Shell sessions, RDP connections, custom port forwarding, and host port forwarding.
          </p>
          <div class="container-xxl px-4 py-5">
            <h2 class="pb-2 border-bottom">Getting Started</h2>
            <div class="row align-items-md-stretch text-start pt-3">
              <div class="col-md-6 pb-5">
                <div class="card h-100">
                  <h5 class="card-header">AWS CLI v2</h5>
                  <div class="card-body">
                    <p class="card-text">
                    The AWS Command Line Interface (AWS CLI) is an open source tool that enables you to interact with AWS services using commands in your command-line shell.
                    </p>
                    <a class="btn btn-primary" type="button" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank">Read More</a>
                  </div>
                </div>
              </div>
              <div class="col-md-6 pb-5">
                <div class="card h-100">
                  <h5 class="card-header">Session Manager Plugin</h5>
                  <div class="card-body">
                    <p class="card-text">
                      To initiate Session Manager sessions with your managed nodes by using the AWS Command Line Interface (AWS CLI), you must install the Session Manager plugin on your local machine.
                    </p>
                    <a class="btn btn-primary" type="button" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html" target="_blank">Read More</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- page: instances -->

    <div id="instances" class="container-fluid page">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Instances</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group mr-2">
            <!-- Buttons -->
            <div class="row g-3 align-items-center">
              <div class="col-auto">
                <select id="profileSelect" class="form-select" v-model="currentProfile">
                  <option value="">Select Profile</option>
                  <option v-for="profile in profiles" :value="profile.name" v-html="profile.name"></option>
                </select>
              </div>
              <div class="col-auto">
                <select id="regionSelect" class="form-select" v-model="currentRegion">
                  <option value="">Select Region</option>
                  <option v-for="region in regionsSelected" :value="region" v-html="region"></option>
                </select>
              </div>
              <div class="col-auto">
                <button id="connectBtn" class="btn btn-success" @click="connect()">
                  <span v-if="isConnecting" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  <span v-if="isConnecting" class="visually-hidden">Connecting...</span>
                  <i v-if="!isConnecting" class="bi bi-search"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row page-body">
        <div class="col-md-7 order-2 order-md-1">
          <!-- Instances card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-hdd-rack-fill"></i>
                <div class="m-0">Instances</div>
              </div>
              <div>
                <span class="badge bg-info" v-if="currentAccountId != ''" v-html="'AWS Account Id: ' + currentAccountId"></span>
                <span class="m-1"></span>
                <span class="badge" :class="instancesCount > 0 ? 'bg-primary' : 'bg-secondary'" v-html="instancesCount + ' instances'"></span>
              </div>
            </div>
            <div class="card-body-flush overflow-y-auto w-100">
              <!-- Instances Table -->
              <div class="text-center text-muted p-4 h-100" v-if="instancesCount == 0">
                <i class="bi bi-hdd-rack-fill"></i>
                <p class="mt-2">No instances found</p>
              </div>
              <div class="accordion accordion-flush" id="accordionInstances">
                <div class="accordion-item" v-for="instance in instances" :key="instance.name">
                  <h2 class="accordion-header d-flex justify-content-between align-items-center">
                    <button
                      class="accordion-button collapsed flex-grow-1"
                      type="button"
                      data-bs-toggle="collapse"
                      :data-bs-target="'#' + instance.id"
                      aria-expanded="false"
                      :aria-controls="instance.id"
                      @click.once="getInstanceDetails(instance.id)"
                    >
                      <div class="text-start d-flex w-100">
                        <div class="row d-flex w-100">
                          <div class="col-2 align-middle text-center" style="width:25px;">
                            <span class="text-success align-middle" v-if="instance.state == 'running'" title="Running"><i class="bi bi-check-circle-fill"></i></span>
		                        <span class="text-danger align-middle" v-if="instance.state == 'stopped'" title="Stopped"><i class="bi bi-stop-circle-fill"></i></span>
		                        <span class="text-danger align-middle" v-if="instance.state == 'terminated'" title="Terminated"><i class="bi bi-x-circle"></i></span>
                          </div>
                          <div class="col-10">
                            <div><b><span v-html="instance.name"></span></b></div>
                            <small class="text-muted" v-html="instance.id"></small>
                          </div>
                        </div>
                      </div>
                    </button>
                    <div class="d-flex me-1">
                      <button class="btn btn-sm start-shell me-2" title="Shell" @click="startShell(instance.id, instance.name)">
                        <i class="bi bi-terminal"></i>
                      </button>
                      <button class="btn btn-sm start-rdp me-2" title="RDP" @click="startRdp(instance.id, instance.name)">
                        <i class="bi bi-display"></i>
                      </button>
                      <button class="btn btn-sm start-port-forward text-white me-2" title="Port Forwarding" @click="showPortForwardingModal(instance.id, instance.name)">
                        <i class="bi bi-arrow-left-right"></i>
                      </button>
                    </div>
                  </h2>
                  <!-- Instance Details -->
                  <div :id="instance.id" class="accordion-collapse collapse">
                    <div class="accordion-body m-0 pt-0 pb-2 px-4">
                      <div class="row">
                        <div class="col">
                          <small class="text-success ps-2" v-if="instance.state == 'running'" title="Running"><i class="bi bi-check-circle-fill"></i><span class="ps-1">Running</span></small>
                          <small class="text-danger ps-2" v-if="instance.state == 'stopped'" title="Stopped"><i class="bi bi-stop-circle-fill"></i><span class="ps-1">Stopped</span></small>
                          <small class="text-danger ps-2" v-if="instance.state == 'terminated'" title="Terminated"><i class="bi bi-x-circle"></i><span class="ps-1">Terminated</span></small>
                        </div>
                        <div class="col">
	                        <small class="text-muted ps-2" v-if="instance.os == 'Windows'"><i class="bi bi-windows"></i><span class="ps-1">Windows</span></small>
		                      <small class="text-muted ps-2" v-if="instance.os == 'Linux' || instance.os == 'Linux/UNIX'"><i class="bi bi-tux"></i><span class="ps-1">Linux</span></small>
		                      <small class="text-muted ps-2" v-if="instance.os != 'Linux' && instance.os != 'Linux/UNIX' && instance.os != 'Windows'">
                            <i class="bi bi-pc"></i><span class="ps-1" v-html="instance.os"></span>
                          </small>
                        </div>
                        <div class="col">
		                      <small class="text-muted ps-2" v-if="instance.type"><i class="bi bi-hdd-rack-fill"></i><span class="ps-1" v-html="instance.type" style="cursor: pointer;" @click="copyToClipboard(instance.type)"></span></small>
                        </div>
                      </div>
                      <div class="row border-top">
                        <div class="col-3 text-end fw-bold"><small>Port Mappings</small></div>
                        <div class="col-8 text-start text-muted">
                          <div class="row" v-for="port in portMappings[instance.name]" v-if="instance.name in portMappings">
                            <div class="col-5 text-start"><span v-html="port.local_port"></span></div>
                            <div class="col-1"><i class="bi bi-arrow-right-short"></i></div>
                            <div class="col-5 text-start"><span v-html="port.remote_port"></span></div>
                          </div>
                        </div>
                        <div class="col-1 text-end">
                          <i class="bi bi-pencil-square edit-port-mapping" @click="showPortMappingsModal(instance.id, instance.name)"></i>
                        </div>
                      </div>
                      <div class="row border-top" v-for="column in instanceDetailsColumns">
                        <div class="col-3 text-end fw-bold"><small v-html="column.title"></small></div>
                        <div class="col-9 text-start text-muted">
                          <small v-if="instance.id in instancesDetails" v-html="instancesDetails[instance.id][column.field]" style="cursor: pointer;" @click="copyToClipboard(instancesDetails[instance.id][column.field])"></small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-5 order-1 order-md-2">
          <!-- Active Connections card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-diagram-2-fill"></i>
                <div class="m-0">Active Connections</div>
              </div>
              <span class="badge" :class="activeConnectionsCount > 0 ? 'bg-primary' : 'bg-secondary'" v-html="activeConnectionsCount + ' active'"></span>
            </div>
            <div class="card-body">
              <!-- Active Connections Table -->
              <div class="text-center text-muted p-4 h-100" v-if="activeConnectionsCount == 0">
                <i class="bi bi-diagram-2-fill"></i>
                <p class="mt-2">No active connections</p>
              </div>
              <ol class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-start ps-0 pe-2 py-2" v-for="connection in activeConnections">
                  <div class="text-start d-flex w-100">
                    <div class="row d-flex w-100">
                      <div class="col-3 align-middle text-center" style="width:50px;">
                        <button class="btn btn-sm connection-shell mx-2" title="Shell" v-if="connection.type == 'Shell'">
                          <i class="bi bi-terminal"></i>
                        </button>
                        <button class="btn btn-sm connection-rdp mx-2" title="RDP" v-if="connection.type == 'RDP'" @click="openRdpClient(connection.instance.id, connection.name, connection.local_port)">
                          <i class="bi bi-display"></i>
                        </button>
                        <button class="btn btn-sm connection-port-forward text-white mx-2" title="Port Forwarding" v-if="connection.type == 'Custom Port' || connection.type == 'Remote Host Port'">
                          <i class="bi bi-arrow-left-right"></i>
                        </button>
                      </div>
                      <div class="col-9">
                        <div><b><span v-html="connection.name"></span></b></div>
                        <div>
                          <small class="text-muted" v-if="connection.local_port" v-html="connection.local_port"></small>
                          <i class="bi bi-arrow-right-short" v-if="connection.local_port"></i>
                          <small class="text-muted" v-if="connection.remote_host" v-html="connection.remote_host + ':'"></small>
                          <small class="text-muted" v-if="connection.remote_port" v-html="connection.remote_port"></small>
                        </div>
                        <div><small class="text-muted" v-html="timeAgo(connection.timestamp)"></small></div>
                        <div>
                          <small class="badge text-white me-1" style="background-color: #6495ed" v-html="connection.region"></small>
                          <small class="badge text-white" style="background-color: #6495ed" v-html="connection.profile"></small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button class="btn btn-sm btn-outline-danger" @click="disconnect(connection.connection_id)">
                    <i class="bi bi-x-lg"></i>
                  </button>
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- page: preferences -->

    <div id="preferences" class="container-fluid page">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Preferences</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group mr-2">
            <!-- Buttons -->
            <button type="button" class="btn btn-outline-success" @click="savePreferences()">
              <i class="bi bi-floppy-fill"></i>&nbsp;&nbsp;Save
            </button>
          </div>
        </div>
      </div>
      <div class="row page-body">
        <div class="col-lg-6">
          <!-- Port Range card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-ethernet"></i>
                <div class="m-0">Ports</div>
              </div>
              <span class="badge" :class="prefPortCount > 0 ? 'bg-primary' : 'bg-danger'" v-html="prefPortCount + ' ports in range'"></span>
            </div>
            <div class="card-body">
              <h5 class="mb-1">Dynamic Port Range</h5>
              <p class="small text-muted">This range is used to dynamically and randomly allocate ports for host port forwarding when connecting to instances.</p>
              <p class="small text-muted">Ports are checked for availability before being allocated, and if a port is already in use, the next available random port in the range will be used.</p>
              <form>
                <div class="mb-3">
                  <label class="small mb-1" for="prefPortStart">Starting Port</label>
                  <input class="form-control" id="prefPortStart" type="number" placeholder="60000" min="1024" v-model="prefPortStart">
                </div>
                <div class="mb-3">
                  <label class="small mb-1" for="prefPortEnd">Ending Port</label>
                  <input class="form-control" id="prefPortEnd" type="number" placeholder="65535" max="65535" v-model="prefPortEnd">
                </div>
              </form>
            </div>
          </div>
          <!-- Logging card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-journal-text"></i>
                <div class="m-0">Logging</div>
              </div>
            </div>
            <div class="card-body">
              <h5 class="mb-1">Verbosity</h5>
              <p class="small text-muted">This defines the level of detail that will be logged in the application.</p>
              <form>
                <div class="form-check">
                  <input class="form-check-input" id="prefLogLevel1" type="radio" name="prefLogLevel" value="DEBUG" v-model="prefLogLevel">
                  <label class="form-check-label" for="prefLogLevel1">Debug</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" id="prefLogLevel2" type="radio" name="prefLogLevel" value="INFO" v-model="prefLogLevel">
                  <label class="form-check-label" for="prefLogLevel2">Info</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" id="prefLogLevel3" type="radio" name="prefLogLevel" value="WARNING" v-model="prefLogLevel">
                  <label class="form-check-label" for="prefLogLevel3">Warning</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" id="prefLogLevel4" type="radio" name="prefLogLevel" value="ERROR" v-model="prefLogLevel">
                  <label class="form-check-label" for="prefLogLevel4">Error</label>
                </div>
              </form>
            </div>
          </div>
          <!-- Regions card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-geo-alt-fill"></i>
                <div class="m-0">Regions</div>
              </div>
              <span class="badge" :class="prefRegionsCount > 0 ? 'bg-primary' : 'bg-secondary'" v-html="prefRegionsCount + ' selected regions'"></span>
            </div>
            <div class="card-body">
              <h5 class="mb-1">Visible Regions</h5>
              <p class="small text-muted">Selecting regions will limit the regions that are visible in the application. This is useful if you only work with a specific set of regions and want to reduce clutter.</p>
              <p class="small text-muted">If no regions are selected, all regions will be visible.</p>
              <form>
                <div class="form-check">
                  <select class="form-select" id="prefRegions" name="prefRegions" size="10" multiple v-model="prefRegions">
                    <option v-for="region in regionsAll" :value="region" v-html="region"></option>
                  </select>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="col-lg-6" v-if="operating_system == 'Windows' || operating_system == 'Linux'">
          <!-- Credentials card-->
          <div class="card mb-4 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-key"></i>
                <div class="m-0">Credentials</div>
              </div>
              <span class="badge" :class="prefCredentialsCount > 0 ? 'bg-primary' : 'bg-secondary'" v-html="prefCredentialsCount + ' credentials'"></span>
            </div>
            <div class="card-body">
              <p class="small text-muted">These credentials will be stored in a key ring on your system.</p>
              <p class="small text-muted" v-if="operating_system == 'Windows'">
                On Windows, these will be stored as generic credentials in the Windows Credential Manager.
                They can be used to dynamically create Windows Credentials for tools such as SQL Server Management Studio (SSMS) or other applications that support Windows Authentication.
              </p>
              <p class="small text-muted" v-if="operating_system == 'Linux'">
                On Linux, there is currently no supported use for these credentials, but they can be used to store credentials for other applications that support key rings.
              </p>
              <p>
                <span class="text-secondary">
                    Leave the password blank to skip saving or updating.
                </span>
              </p>
              <div class="row mb-2 align-items-center">
                <div class="col-5 fw-bold">Username</div>
                <div class="col-7 fw-bold">Password</div>
              </div>
              <div v-for="(cred, index) in prefCredentials" :key="index" class="row mb-2 align-items-center">
                <div class="col-5">
                  <input type="text" class="form-control" v-model="cred.username" placeholder="domain\username" aria-label="Username" aria-describedby="'credUsername' + index">
                </div>
                <div class="col-5">
                  <input type="text" class="form-control" v-model="cred.password" placeholder="new password" aria-label="Password" aria-describedby="'credPassword' + index">
                </div>
                <div class="col-2 align-items-end text-align-end">
                  <button type="button" class="btn btn-danger" @click="removeCredential(index)" :disabled="prefCredentials.length === 0">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              <button type="button" class="btn btn-primary w-100" @click="addCredential">
                Add Credential
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>

<!-- page: profiles -->

    <div id="profiles" class="container-fluid page">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h1 class="h2">Profiles</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group mr-2">
            <!-- Buttons -->
          </div>
        </div>
      </div>
      <div class="d-flex flex-column page-body">
        <!-- Profiles card-->
        <div class="card shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-person-lines-fill"></i>
              <div class="m-0">AWS Profiles</div>
            </div>
            <span class="badge" :class="profilesCount > 0 ? 'bg-primary' : 'bg-secondary'" v-html="profilesCount + ' profiles'"></span>
          </div>
          <div class="card-body overflow-auto m-0 px-0 pb-0 pt-1">
            <div class="text-center text-muted p-4 h-100" v-if="profilesCount == 0">
              <i class="bi bi-person-lines-fill"></i>
              <p class="mt-2">No profiles</p>
            </div>
            <table class="table table-striped table-hover w-100" v-if="profilesCount > 0">
              <thead class="small text-uppercase">
                <tr>
                  <th v-for="column in profilesTableColumns" v-html="column.title"></th>
                </tr>
              </thead>
              <tbody>
                <tr class="align-middle" v-for="profile in profiles">
                  <td v-for="column in profilesTableColumns" :key="column.field">
                    <span v-html="profile[column.field]"></span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12 mb-3 mb-lg-5">
          <div class="overflow-hidden card table-nowrap table-card shadow-sm">
          </div>
        </div>
      </div>
    </div>

<!-- toast -->

    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3">
    </div>

<!-- modal: port forwarding -->

    <div class="modal fade" id="portForwardingModal" tabindex="-1" aria-labelledby="portForwardingModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="portForwardingModalLabel">Port Forwarding</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-2">
              <label class="input-group-text" for="portForwardingMode">Mode</label>
              <select class="form-select" id="portForwardingMode" v-model="portForwardingModalProperties.mode">
                <option value="local">Remote Port</option>
                <option value="other">Remote Host and Port</option>
              </select>
            </div>
            <div class="input-group mb-2" v-if="portForwardingModalProperties.mode == 'other'">
              <span class="input-group-text" id="portForwardingHostLabel">Remote Host</span>
              <input id="portForwardingHost" type="text" class="form-control" placeholder="google.com" aria-label="Host" aria-describedby="portForwardingHostLabel" v-model="portForwardingModalProperties.remoteHost">
            </div>
            <div class="input-group mb-2">
              <span class="input-group-text" id="portForwardingPortLabel">Remote Port</span>
              <input id="portForwardingPort" type="text" class="form-control" placeholder="80" aria-label="Port" aria-describedby="portForwardingPortLabel" max="65535" v-model="portForwardingModalProperties.remotePort">
            </div>
            <div class="input-group mb-2" v-if="operating_system == 'Windows' || operating_system == 'Linux'">
              <label class="input-group-text" for="portForwardingCredential">Credential</label>
              <select class="form-select" id="portForwardingCredential" v-model="portForwardingModalProperties.credentials">
                <option v-for="cred in prefCredentials" :value="cred.username" v-html="cred.username"></option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" @click="startPortForwarding">
              <span v-if="portForwardingStarting" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              <span v-if="portForwardingStarting" class="visually-hidden">Connecting...</span>
              <span v-if="!portForwardingStarting">Connect</span>
            </button>
          </div>
        </div>
      </div>
    </div>

<!-- modal: port mappings -->

    <div class="modal fade" id="portMappingsModal" tabindex="-1" aria-labelledby="portMappingsModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="portMappingsModalLabel">Port Mapping</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="border-bottom pb-1">
              <small>
                <span class="text-secondary">Port mappings allow you to define static local ports for port forwarding.</span>
                <br>
                <span class="text-secondary">Local ports must be unique across all instances.</span>
              </small>
            </div>
            <div v-for="(mapping, index) in portMappingsModalProperties" :key="index" class="row mt-2 mb-2 align-items-center">
              <div class="col">
                <div class="input-group">
                  <span class="input-group-text" :id="'portMappingLocal' + index">Local</span>
                  <input type="number" class="form-control" v-model="mapping.local_port" aria-label="Local" aria-describedby="'portMappingLocal' + index" max="65535">
                </div>
              </div>
              <div class="col">
                <div class="input-group">
                  <span class="input-group-text" :id="'portMappingRemote' + index">Remote</span>
                  <input type="number" class="form-control" v-model="mapping.remote_port" aria-label="Remote" aria-describedby="'portMappingRemote' + index" max="65535">
                </div>
              </div>
              <div class="col-auto">
                <button type="button" class="btn btn-danger" @click="removePortMapping(index)" :disabled="portMappings.length === 1">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
            <button type="button" class="btn btn-primary w-100" @click="addPortMapping">
              Add Mapping
            </button>
          </div>
          <div class="modal-footer">
            <span v-if="portMappingsModalDuplicatePort" class="text-danger me-4">
              <small>
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span class="ps-2">Duplicate local port detected.</span>
              </small>
            </span>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" @click="savePortMappings(portMappingsModalInstance.id, portMappingsModalInstance.name)">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>

<!-- footer -->

    <footer></footer>

  </main>
</body>
</html>
